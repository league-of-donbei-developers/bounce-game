<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<style>
			html,body{
				margin: 0px;
				padding: 0px;
			}
			#canvas{
				height: 100%;
				width: 100%;
				background-color: black;
				position: absolute;
				top:0px;
				left: 0px;
			}
		</style>
	</head>
	<body id="body">
		<canvas id="canvas" width="" height=""></canvas>
	</body>
</html>
<script>
	
	let canvas = document.getElementById('canvas');
	
	let ctx = canvas.getContext('2d');
	
	canvas.height = window.innerHeight;
	canvas.width = window.innerWidth;
	
	let left_bound  = canvas.width / 3;
	let right_bound = canvas.width - left_bound;
	
	
	ctx.strokeStyle = 'white';
	ctx.beginPath();
	ctx.moveTo(left_bound,0);
	ctx.lineTo(left_bound,canvas.height);
	ctx.stroke();
	
	ctx.beginPath();
	ctx.moveTo(right_bound,0);
	ctx.lineTo(right_bound,canvas.height);
	ctx.stroke(); 	
	
	class Brick{
		
		
		constructor(x,y,width,height){
			this.x = x;
			this.y = y;
			this.width = width;
			this.height = height;
			
		}
		
		draw(){
			ctx.strokeStyle = 'white';
			ctx.fillStyle = '#55007f';
			ctx.beginPath();
			ctx.moveTo(this.x,this.y);
			ctx.lineTo(this.x + this.width,this.y);
			ctx.lineTo(this.x + this.width,this.y + this.height);
			ctx.lineTo(this.x,this.y + this.height);
			ctx.closePath();
			ctx.stroke();
			ctx.fill();
		}
		
		checkCollision(ball){
			let x = ball.x;
			let y = ball.y;
			let bottom = this.y + this.height;
			let right = this.x + this.width;
			let top = this.y;
			let left = this.x;
			let dis = ball.radius;
			
			if(Math.abs(left - x) <= dis && y >= top && y <= bottom){
				ball.changeDir(1)
				return true;
			}
			if(Math.abs(x - right) <= dis && y >= top && y <= bottom){
				ball.changeDir(0);
				return true;
			}
			if(Math.abs(bottom - y) <= dis && x >= left && x <= right){
				ball.changeDir(3);
				return true;
			}
			if(Math.abs(top - y) <= dis && x >= left && x <= right){
				ball.changeDir(2);
				return true;
			}
			return false;
		}
	
	}
	
	let brickList = [];
	for(let i = 0;i < 20;i++){
		for(let j = 0;j < 40;j++){
			brickList.push(new Brick(left_bound + 50 + j * 10,
									150 + i * 20,
									10,
									10));
		}
	}
	
	for(let i = 0;i < brickList.length;i++){
		brickList[i].draw();
	}
	
	class Ball{
		
		constructor(x,y,speedx,speedy,radius,tag){
			this.x = x;
			this.y = y;
			this.speedx = speedx;
			this.speedy = speedy;
			this.radius = radius;
			this.tag = tag;
			this.activate = true;
		}
		
		update(){
			let x = this.x + this.speedx;
			let y = this.y + this.speedy;
			
			if(x - this.radius <= left_bound){
				this.speedx = Math.abs(this.speedx);
			}
			if(x + this.radius >= right_bound){
				this.speedx = -Math.abs(this.speedx);
			}
			
			if(y + this.radius >= canvas.height){
				this.activate = false;
				//this.tag = 0;
			}
			
			if(y - this.radius <= 0){
				this.speedy = Math.abs(this.speedy);
				// this.speedy = Math.abs(this.speedy);
				// this.tag = 1;
			}
			
			this.x += this.speedx;
			this.y += this.speedy;
		}
		
		draw(){
			ctx.fillStyle = this.tag == 0 ? 'firebrick' : '#0055ff';
			ctx.beginPath();
			ctx.arc(this.x,this.y,this.radius,0,Math.PI * 2);
			ctx.fill();
		}
		
		changeDir(dir){
			switch(dir){
				case 0:this.speedx = Math.abs(this.speedx);break;		//右
				case 1:this.speedx = -Math.abs(this.speedx);break;		//左
				case 2:this.speedy = -Math.abs(this.speedy);break;		//上
				case 3:this.speedy = Math.abs(this.speedy);break;		//下
			}
		}
	}
	
	
	let ballList = [];

	for(let i = 0;i < 15;i++){
		let tag = Math.floor(Math.random() * 2);
		ballList.push(new Ball(Math.random() * (right_bound - left_bound) + left_bound,
							//tag ? -Math.random() * 40 + canvas.height : Math.random() * 40,
							Math.random() * 40,
							Math.random() * 2 + 2,
							Math.random() * 2 + 2,5,tag));
	}
	
	class board
	{
		constructor(dx,dy,len,wide,speed)
		{
			this.x = dx-len/2; // 左上横坐标
			this.y = dy-wide/2; // 左上纵坐标
			this.len = len; // 长度
			this.width = wide; // 宽度
			this.speed = speed; // 移动速度
			this.dir = 0;
		}
		draw()
		{
			ctx.fillStyle = 'white';
			ctx.fillRect(this.x,this.y,this.len,this.width);
		}	
		update()
		{
			if(this.dir == 1)
			{
				if(this.x + this.len + this.speed <= right_bound)
					this.x = this.x + this.speed; 
			}
			if(this.dir == -1)
			{
				if(this.x - this.speed >= left_bound)
					this.x = this.x - this.speed; 
			}
		}
		checkCollision(ball)
		{
			let x = ball.x;
			let y = ball.y;
			let bottom = this.y + this.width;
			let right = this.x + this.len;
			let top = this.y;
			let left = this.x;
			let dis = ball.radius;
			
			if(Math.abs(left - x) <= dis && y >= top && y <= bottom){
				ball.changeDir(1);
				ball.tag = ball.tag ^ 1;  
				return true;
			}
			if(Math.abs(x - right) <= dis && y >= top && y <= bottom){
				ball.changeDir(0);
				ball.tag = ball.tag ^ 1;
				return true;
			}
			if(Math.abs(bottom - y) <= dis && x >= left && x <= right){
				ball.changeDir(3);
				ball.tag = ball.tag ^ 1;
				return true;
			}
			if(Math.abs(top - y) <= dis && x >= left && x <= right){
				ball.changeDir(2);
				ball.tag = ball.tag ^ 1;
				return true;
			}
			return false;
		}
	}
	
	let myBoard = new board((left_bound+right_bound)/2,
						canvas.height-50,
						(right_bound-left_bound)/7,
						10,//宽度
						12);//速度

	setInterval(function(){
		ctx.clearRect(left_bound,0,right_bound - left_bound,canvas.height);
		
		for(let i = 0;i < ballList.length;i++){ // 清除飞出去的小球
			ballList[i].update();
			if(ballList[i].activate == false){
				ballList.splice(i,1);
				i--;
			}
		}
		for(let i = 0;i < ballList.length;i++){
			for(let j = 0;j < brickList.length;j++){
				if(brickList[j].checkCollision(ballList[i])){
					brickList.splice(j,1);
					j--;
				}
			}
			myBoard.checkCollision(ballList[i]);
			ballList[i].draw();
		}
		for(let i = 0;i < brickList.length;i++){
			brickList[i].draw();
		}

		if(ballList.length == 0 && brickList.length > 0)
		{
			alert("You Lose!");
			return 0;
		}
		if(brickList.length == 0)
		{
			alert("You Win!");
			return 0;
		}

	},1000 / 60);

	var render = function(){
		myBoard.update();
		myBoard.draw();
		window.requestAnimationFrame(render);
		window.onkeydown = function(e)
		{
			var e = e || window.event;
			if(e.keyCode == 37){
				e.preventDefault(); 
				myBoard.dir = -1; // 左移
			}
			if(e.keyCode == 39){
				e.preventDefault();
				myBoard.dir = 1; // 右移
			}	
		}
		window.onkeyup = function(e)
		{
			var e = e || window.event;
			if(e.keyCode == 37 || e.keyCode == 39)
				myBoard.dir = 0;
		}
	};
	render();
</script>


